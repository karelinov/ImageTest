package Application;

import javafx.scene.Node;
import javafx.scene.canvas.*;
import javafx.scene.image.Image;
import javafx.scene.image.WritableImage;
import javafx.embed.swing.SwingFXUtils;

import java.sql.*;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;

import java.awt.image.BufferedImage;
import javax.imageio.ImageIO;

public class ImageCreator {
	public static BufferedImage CreateImage() {
		
		Canvas canvas = new Canvas(416,88);
		final GraphicsContext gc = canvas.getGraphicsContext2D();
		gc.drawImage(GetActionDBImage("VMS","2"), 0, 0);
		
		
		WritableImage writableImage = canvas.snapshot(null, null);
		BufferedImage bufferedImage = SwingFXUtils.fromFXImage(writableImage, null);
		//ImageIO.write(bufferedImage, format, outputFile)
		
		return bufferedImage;
	}
	
	
	private static Image GetActionDBImage(String deviceType, String imageCode) {
     Image result = null;
	 Connection c = null;
     PreparedStatement stmt = null;
     
     try {
	     //Class.forName("org.postgresql.Driver");
	     c = DriverManager.getConnection("jdbc:postgresql://172.16.10.21:5432/actions","postgres", "Bhz8/jYkjW8=");
	     System.out.println("Opened database successfully");
	
	     String sql = "select * from actions_schema.signs where device_type=? and sign_code=?";
	     stmt = c.prepareStatement(sql);
	     stmt.setString(1, deviceType);
	     stmt.setString(2, imageCode);
	     ResultSet resultSet =  stmt.executeQuery();
	     resultSet.next();
	     result = new Image(resultSet.getBinaryStream("sign_file"));
	     stmt.close();
	     c.close();
     }
     catch(Exception e) {
    	 System.err.println( e.getClass().getName()+": "+ e.getMessage());
     }
	     
     return result;
	}

}
